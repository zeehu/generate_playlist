# generate_playlist: ç”Ÿæˆå¼æ­Œå•æ¨èç³»ç»Ÿ

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯ï¼ˆEnd-to-Endï¼‰æœºå™¨å­¦ä¹ æµç¨‹ï¼Œç”¨äºæ ¹æ®ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ï¼ˆå¦‚æ­Œå•æ ‡é¢˜ã€æƒ…ç»ªæè¿°ï¼‰ç”Ÿæˆä¸€ä¸ªæ¨èçš„æ­Œæ›²åºåˆ—ã€‚ç³»ç»Ÿæ ¸å¿ƒé‡‡ç”¨ä¸¤é˜¶æ®µæ¨¡å‹æ¶æ„ï¼š

1.  **RQ-VAE / RQ-Kmeans**: é¦–å…ˆï¼Œä½¿ç”¨æ®‹å·®é‡åŒ–æ–¹æ³•å°†æ¯é¦–æ­Œæ›²é«˜ç»´ã€è¿ç»­çš„å‘é‡ï¼ˆä¾‹å¦‚100ç»´ï¼‰å‹ç¼©ä¸ºä½ç»´ã€ç¦»æ•£çš„â€œè¯­ä¹‰IDâ€ã€‚
2.  **T5 æ¨¡å‹**: ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªå¼ºå¤§çš„åºåˆ—åˆ°åºåˆ—æ¨¡å‹ï¼ˆT5ï¼‰ï¼Œå­¦ä¹ ä»è¾“å…¥çš„æ–‡æœ¬æè¿°åˆ°ç›®æ ‡æ­Œæ›²è¯­ä¹‰IDåºåˆ—çš„æ˜ å°„å…³ç³»ã€‚

## ğŸš€ é¡¹ç›®ç‰¹ç‚¹

- **ç«¯åˆ°ç«¯æµç¨‹**: åŒ…å«ä»æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒã€æ•ˆæœè¯„ä¼°åˆ°æœ€ç»ˆæ¨ç†æ¼”ç¤ºçš„å®Œæ•´æ­¥éª¤ã€‚
- **ä¸¤é˜¶æ®µæ¨¡å‹**: è§£è€¦äº†ç‰©å“è¡¨ç¤ºå­¦ä¹ å’Œåºåˆ—ç”Ÿæˆï¼Œä½¿æµç¨‹æ›´æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•å’Œæ‰©å±•ã€‚
- **é…ç½®é©±åŠ¨**: æ‰€æœ‰å…³é”®å‚æ•°ï¼ˆå¦‚æ–‡ä»¶è·¯å¾„ã€æ¨¡å‹è¶…å‚ï¼‰éƒ½åœ¨ `config.py` ä¸­ç»Ÿä¸€ç®¡ç†ã€‚
- **å¤šGPUæ”¯æŒ**: è®­ç»ƒå’Œè¯„ä¼°è„šæœ¬å‡å†…ç½®äº†å¯¹åˆ†å¸ƒå¼è®¡ç®—çš„æ”¯æŒã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ config.py           # ä»»åŠ¡ä¸“å±çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ train_rqvae.py      # é˜¶æ®µ1: è®­ç»ƒRQ-VAE (æ–¹æ³•ä¸€)
â”œâ”€â”€ train_rq_kmeans.py  # é˜¶æ®µ1: è®­ç»ƒRQ-KMeans (æ–¹æ³•äºŒ)
â”œâ”€â”€ evaluate_rqvae.py   # é˜¶æ®µ1b: è¯„ä¼°RQ-VAEè´¨é‡
â”œâ”€â”€ evaluate_rq_kmeans.py # é˜¶æ®µ1b: è¯„ä¼°RQ-KMeansè´¨é‡
â”œâ”€â”€ prepare_corpus.py   # é˜¶æ®µ2: ç”ŸæˆT5æ¨¡å‹è®­ç»ƒè¯­æ–™
â”œâ”€â”€ train_tiger.py      # é˜¶æ®µ3: è®­ç»ƒT5ç”Ÿæˆæ¨¡å‹
â”œâ”€â”€ evaluate_tiger.py   # é˜¶æ®µ4: è¯„ä¼°T5æ¨¡å‹æ€§èƒ½
â”œâ”€â”€ generate_playlist.py# é˜¶æ®µ5: äº¤äº’å¼æ¨ç†ä¸æ¼”ç¤º
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜æ–‡ä»¶
â”œâ”€â”€ requirements.txt      # (éœ€è¦æ‚¨æ‰‹åŠ¨åˆ›å»º)
â”œâ”€â”€ models/                 # (è‡ªåŠ¨ç”Ÿæˆ) å­˜å‚¨è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
â”œâ”€â”€ outputs/                # (è‡ªåŠ¨ç”Ÿæˆ) å­˜å‚¨ä¸­é—´ç”Ÿæˆæ–‡ä»¶
â””â”€â”€ logs/                   # (è‡ªåŠ¨ç”Ÿæˆ) å­˜å‚¨è®­ç»ƒæ—¥å¿—
```

## âš™ï¸ ç¯å¢ƒä¸å®‰è£…

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/zeehu/generate_playlist.git
cd generate_playlist
```

### 2. ç¯å¢ƒé…ç½®
- **Python ç‰ˆæœ¬**: æ¨èä½¿ç”¨ Python 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
- **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ** (æ¨è):
    ```bash
    python -m venv venv
    source venv/bin/activate
    ```

### 3. å®‰è£…ä¾èµ–
æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª `requirements.txt` æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒä¾èµ–ï¼Œç„¶åé€šè¿‡ `pip` å®‰è£…ã€‚

```
# requirements.txt
torch
torchvision
transformers
pandas
numpy
scikit-learn
rouge_score
nltk
tqdm
sentencepiece
faiss-cpu # æˆ– faiss-gpu
accelerate
```

```bash
pip install -r requirements.txt
```

## ğŸ’¿ æ•°æ®å‡†å¤‡

åœ¨è¿è¡Œä»»ä½•è„šæœ¬ä¹‹å‰ï¼Œæ‚¨å¿…é¡»å‡†å¤‡å¥½ä»¥ä¸‹å››ä»½æ•°æ®æ–‡ä»¶ï¼Œå¹¶**åœ¨ `config.py` ä¸­é…ç½®å¥½å®ƒä»¬çš„è·¯å¾„**ã€‚

1.  **æ­Œæ›²å‘é‡æ–‡ä»¶**: `song_vectors.csv` (ç¤ºä¾‹å)
2.  **æ­Œå•ä¿¡æ¯æ–‡ä»¶**: `gen_playlist_info.csv` (ç¤ºä¾‹å)
3.  **æ­Œå•-æ­Œæ›²å…³ç³»æ–‡ä»¶**: `gen_playlist_song.csv` (ç¤ºä¾‹å)
4.  **æ­Œæ›²å…ƒä¿¡æ¯æ–‡ä»¶**: `gen_song_info.csv` (ç¤ºä¾‹å)

#### **å…³é”®é…ç½®æ­¥éª¤**

æ‰“å¼€ `config.py` æ–‡ä»¶ï¼Œæ‰¾åˆ° `DataConfig` å’Œ `SongRQVAEConfig` ç±»ï¼Œå¹¶å¡«å…¥æ‚¨æ•°æ®æ–‡ä»¶çš„**ç»å¯¹è·¯å¾„**ã€‚

## ğŸš€ æ‰§è¡Œæ­¥éª¤

è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆ`generate_playlist`ï¼‰ä¸‹ï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œè„šæœ¬ã€‚

### **é˜¶æ®µ1: ç”Ÿæˆæ­Œæ›²è¯­ä¹‰ID**
æ­¤é˜¶æ®µæœ‰ä¸¤ä¸ªæ–¹æ³•å¯é€‰ï¼Œæ‚¨åªéœ€æ‰§è¡Œå…¶ä¸€ã€‚

*   **æ–¹æ³•A: RQ-VAE (åŸºäºç¥ç»ç½‘ç»œï¼Œæ•ˆæœå¯èƒ½æ›´å¥½ä½†æ…¢)**:
    ```bash
    python train_rqvae.py
    # è¯„ä¼°
    python evaluate_rqvae.py
    ```
*   **æ–¹æ³•B: RQ-KMeans (åŸºäºèšç±»ï¼Œé€Ÿåº¦å¿«)**:
    ```bash
    python train_rq_kmeans.py
    # è¯„ä¼°
    python evaluate_rq_kmeans.py
    ```
*   **å†³ç­–**: æ¯”è¾ƒä¸¤ç§æ–¹æ³• `evaluate` è„šæœ¬è¾“å‡ºçš„ `Average Cosine Similarity`ï¼Œé€‰æ‹©ä¸€ä¸ªæ•ˆæœæ›´å¥½çš„æ–¹æ¡ˆç»§ç»­ä¸‹ä¸€æ­¥ã€‚

---

### **é˜¶æ®µ2: ç”Ÿæˆè®­ç»ƒè¯­æ–™**

*   **å‘½ä»¤**: `python prepare_corpus.py`
*   **è¾“å‡º**: `outputs/train.tsv`, `outputs/val.tsv`, `outputs/test.tsv`ã€‚

---

### **é˜¶æ®µ3: è®­ç»ƒT5ç”Ÿæˆæ¨¡å‹**

*   **å‘½ä»¤ (å¤šGPU, æ¨è)**:
    ```bash
    # å°† [GPUæ•°é‡] æ›¿æ¢ä¸ºæ‚¨çš„GPUå¡æ•°, ä¾‹å¦‚ 4
    torchrun --nproc_per_node=[GPUæ•°é‡] train_tiger.py
    ```
*   **è¾“å‡º**: æœ€ç»ˆæ¨¡å‹ `models/tiger_final/`ã€‚

---

### **é˜¶æ®µ4: è¯„ä¼°T5æ¨¡å‹**

*   **å‘½ä»¤ (å¤šGPU, æ¨è)**:
    ```bash
    torchrun --nproc_per_node=[GPUæ•°é‡] evaluate_tiger.py
    ```
*   **è¾“å‡º**: ç»ˆç«¯çš„æ€»ç»“æŠ¥å‘Šï¼Œä»¥åŠ `outputs/evaluation_results.txt` ä¸­çš„è¯¦ç»†å¯¹æ¯”æ–‡ä»¶ã€‚

---

### **é˜¶æ®µ5: äº¤äº’å¼æ¨ç†æ¼”ç¤º**

*   **å‘½ä»¤**: `python generate_playlist.py`
*   **è¾“å‡º**: ä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œè¾“å…¥æ ‡é¢˜å³å¯ç”Ÿæˆæ­Œå•ã€‚